---
import { Menu } from 'lucide-react';
import { ui, defaultLang } from '../i18n/ui';

const currentPath = Astro.url.pathname;
const currentLang = (currentPath.split('/')[1] in ui) ? currentPath.split('/')[1] as keyof typeof ui : defaultLang;

const t = ui[currentLang];

const links = [
  { href: `/${currentLang}`, text: t['nav.home'] },
  { href: `/${currentLang}/accommodatie`, text: t['nav.rooms'] },
  { href: `/${currentLang}/omgeving`, text: t['nav.surroundings'] },
  { href: `/${currentLang}/contact`, text: t['nav.contact'] },
];

const languages = {
  nl: 'NL',
  en: 'EN',
  de: 'DE',
};

const getLangUrl = (lang: string) => {
  const parts = currentPath.split('/');
  // If root "/", parts is ["", ""] or similar depending on Astro. 
  // We want to ensure we keep the path structure. 
  // Current logic assumes /nl, /en, /de prefix is always present due to i18n config.
  parts[1] = lang;
  return parts.join('/') || '/';
};
---

<header class="bg-white/95 backdrop-blur-sm fixed w-full top-0 z-50 border-b border-stone-100 shadow-sm transition-all duration-300">
  <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
    <a href={`/${currentLang}`} class="text-2xl font-serif font-bold text-green-900 tracking-tight hover:opacity-80 transition">
      B&B De Tol
    </a>

    <!-- Desktop Nav -->
    <div class="hidden md:flex items-center gap-8">
      <nav class="flex gap-6">
        {links.map(link => (
          <a href={link.href} class="text-stone-600 hover:text-green-800 font-medium text-sm uppercase tracking-wide transition relative group">
            {link.text}
            <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-green-800 transition-all group-hover:w-full"></span>
          </a>
        ))}
      </nav>

      <div class="h-6 w-px bg-stone-200"></div>

      <!-- Language Switcher -->
      <div class="flex gap-2 text-sm font-medium">
        {Object.entries(languages).map(([lang, label]) => (
          <a 
            href={getLangUrl(lang)} 
            class={`transition-colors ${currentLang === lang ? 'text-green-800 font-bold' : 'text-stone-400 hover:text-stone-600'}`}
          >
            {label}
          </a>
        ))}
      </div>
      
      <a href={`/${currentLang}/contact`} class="bg-green-800 text-white px-6 py-2.5 rounded-full font-bold text-sm tracking-wide shadow-md hover:bg-green-900 hover:shadow-lg hover:-translate-y-0.5 transition-all">
        {t['btn.reserve']}
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <div class="md:hidden flex items-center gap-4">
        <div class="flex gap-2 text-sm font-medium">
            {Object.entries(languages).map(([lang, label]) => (
            <a 
                href={getLangUrl(lang)} 
                class={`transition-colors ${currentLang === lang ? 'text-green-800 font-bold' : 'text-stone-400 hover:text-stone-600'}`}
            >
                {label}
            </a>
            ))}
        </div>
        <button id="mobile-menu-btn" class="p-2 text-stone-600 hover:text-green-800 hover:bg-stone-50 rounded-lg transition" aria-label="Menu">
            <Menu />
        </button>
    </div>
  </div>

  <!-- Mobile Menu Container -->
  <div id="mobile-menu" class="hidden md:hidden bg-white border-b border-stone-100 absolute w-full left-0 top-full shadow-lg">
      <nav class="flex flex-col p-4 space-y-2">
        {links.map(link => (
          <a href={link.href} class="block py-3 px-4 text-stone-700 hover:bg-stone-50 hover:text-green-800 rounded-lg font-medium transition">
            {link.text}
          </a>
        ))}
         <a href={`/${currentLang}/contact`} class="block py-3 px-4 bg-green-800 text-white rounded-lg font-bold text-center mt-4">
            {t['btn.reserve']}
        </a>
      </nav>
  </div>
</header>
<div class="h-16"></div> <!-- Spacer -->

<script is:inline>
  function setupMobileMenu() {
    const mobileBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    if (mobileBtn && mobileMenu) {
      // Clone to remove old event listeners if any (in case of re-runs)
      const newBtn = mobileBtn.cloneNode(true);
      mobileBtn.parentNode.replaceChild(newBtn, mobileBtn);
      
      newBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }
  }

  // Run on initial load
  document.addEventListener('DOMContentLoaded', setupMobileMenu);
  
  // Run on Astro page swaps (if ViewTransitions are ever enabled)
  document.addEventListener('astro:page-load', setupMobileMenu);
</script>
